# ๐ PgBouncer.NET

**Connection pooler ะดะปั PostgreSQL ะฝะฐ .NET** โ ะปะตะณะบะพะฒะตัะฝัะน ะฟัะพะบัะธ-ัะตัะฒะตั ะดะปั ัะฟัะฐะฒะปะตะฝะธั ัะพะตะดะธะฝะตะฝะธัะผะธ ะบ PostgreSQL.

[![.NET](https://img.shields.io/badge/.NET-8.0-512BD4?logo=dotnet)](https://dotnet.microsoft.com/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-13+-336791?logo=postgresql)](https://postgresql.org/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

## ๐ฏ ะัะพะฑะปะตะผะฐ, ะบะพัะพััั ัะตัะฐะตั

ะขะธะฟะธัะฝะฐั ัะธััะฐัะธั:
- **10 ะผะธะบัะพัะตัะฒะธัะพะฒ** ร **200 ัะพะตะดะธะฝะตะฝะธะน** = **2000 ัะพะตะดะธะฝะตะฝะธะน ะบ PostgreSQL**
- PostgreSQL ะดะตัะถะธั ัะพะปัะบะพ **100-500 ัะพะตะดะธะฝะตะฝะธะน**
- ะะตะทัะปััะฐั: `FATAL: too many connections`

**PgBouncer.NET** ะฟัะธะฝะธะผะฐะตั ะฒัะต 2000 ะบะปะธะตะฝัะพะฒ, ะฝะพ ะบ ะฑะฐะทะต ะธะดัั ะผะฐะบัะธะผัะผ 100 ัะพะตะดะธะฝะตะฝะธะน.

## โ๏ธ ะะฐะบ ัะฐะฑะพัะฐะตั

```
โโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโ
โ  ะะปะธะตะฝั 1   โโโโโโถโ                  โ     โ            โ
โโโโโโโโโโโโโโโค     โ                  โ     โ            โ
โ  ะะปะธะตะฝั 2   โโโโโโถโ  PgBouncer.NET   โโโโโโถโ PostgreSQL โ
โโโโโโโโโโโโโโโค     โ   (ะดะพ 2000)      โ     โ  (ะดะพ 100)  โ
โ  ...        โโโโโโถโ                  โ     โ            โ
โโโโโโโโโโโโโโโค     โ                  โ     โ            โ
โ  ะะปะธะตะฝั N   โโโโโโถโ                  โ     โ            โ
โโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโ
```

### ะะตะถะธะผ ัะฐะฑะพัั: Session Pooling ั ะปะธะผะธัะพะผ

- **ะขะธะฟ ะพัะตัะตะดะธ:** FIFO (First In, First Out)
- **ะะปะณะพัะธัะผ:** ะกะตะผะฐัะพั ะพะณัะฐะฝะธัะธะฒะฐะตั backend-ัะพะตะดะธะฝะตะฝะธั
- **ะัะธ ะฟัะตะฒััะตะฝะธะธ ะปะธะผะธัะฐ:** ะะปะธะตะฝัั ะถะดัั ะฒ ะพัะตัะตะดะธ (ัะฐะนะผะฐัั 30 ัะตะบ)

## ๐ ะัััััะน ััะฐัั

### ะขัะตะฑะพะฒะฐะฝะธั

- [.NET 8.0 SDK](https://dotnet.microsoft.com/download/dotnet/8.0)
- PostgreSQL 13+

### ะฃััะฐะฝะพะฒะบะฐ ะธ ะทะฐะฟััะบ

```bash
# 1. ะะปะพะฝะธััะตะผ ัะตะฟะพะทะธัะพัะธะน
git clone https://github.com/your-username/pgbouncer.net.git
cd pgbouncer.net

# 2. ะะฐัััะฐะธะฒะฐะตะผ ะบะพะฝัะธะณััะฐัะธั
# ะะตะดะฐะบัะธััะตะผ src/PgBouncer.Server/appsettings.json

# 3. ะกะพะฑะธัะฐะตะผ ะธ ะทะฐะฟััะบะฐะตะผ
dotnet run --project src/PgBouncer.Server
```

### ะะพะดะบะปััะตะฝะธะต

```
ะัะพะบัะธ:     localhost:6432
Dashboard:  http://localhost:5080
```

ะะพะดะบะปััะฐะนัะตัั ะบ ะฟะพััั **6432** ะฒะผะตััะพ ััะฐะฝะดะฐััะฝะพะณะพ **5432**.

## ๐ ะะพะฝัะธะณััะฐัะธั

`src/PgBouncer.Server/appsettings.json`:

```json
{
  "ListenPort": 6432,
  "DashboardPort": 5080,
  "Backend": {
    "Host": "127.0.0.1",
    "Port": 5432,
    "AdminUser": "postgres",
    "AdminPassword": "your_password"
  },
  "Pool": {
    "MaxSize": 100,
    "ConnectionTimeout": 30
  }
}
```

| ะะฐัะฐะผะตัั                 | ะะฟะธัะฐะฝะธะต                      | ะะพ ัะผะพะปัะฐะฝะธั |
| ------------------------ | ----------------------------- | ------------ |
| `ListenPort`             | ะะพัั ะดะปั ะบะปะธะตะฝัะพะฒ             | 6432         |
| `DashboardPort`          | ะะพัั ะฒะตะฑ-ะดะฐัะฑะพัะดะฐ             | 5080         |
| `Pool.MaxSize`           | ะะฐะบั. ัะพะตะดะธะฝะตะฝะธะน ะบ PostgreSQL | 100          |
| `Pool.ConnectionTimeout` | ะขะฐะนะผะฐัั ะพะถะธะดะฐะฝะธั ัะปะพัะฐ (ัะตะบ)  | 30           |

## ๐ Dashboard

ะะตะฑ-ะธะฝัะตััะตะนั ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ ะฝะฐ `http://localhost:5080`:

- **ะะบัะธะฒะฝัะต backend-ัะพะตะดะธะฝะตะฝะธั** โ ะฝะฐะณััะทะบะฐ ะฝะฐ PostgreSQL
- **ะะปะธะตะฝัั ะฒ ะพัะตัะตะดะธ** โ ะพะถะธะดะฐััะธะต ัะปะพัะฐ
- **ะัะตะผั ะพะถะธะดะฐะฝะธั** โ ััะตะดะฝะตะต ะธ ะผะฐะบัะธะผะฐะปัะฝะพะต
- **ะขะฐะนะผะฐััั** โ ะบะปะธะตะฝัั, ะฝะต ะดะพะถะดะฐะฒัะธะตัั ัะปะพัะฐ

## ๐งช ะกััะตัั-ัะตััะธัะพะฒะฐะฝะธะต

```bash
# ะะฐะฟััะบ ัััะตัั-ัะตััะตัะฐ (10 ะฒะธัััะฐะปัะฝัั ะฟัะพะตะบัะพะฒ)
dotnet run --project tests/PgBouncer.StressTester
```

ะกะธะผัะปะธััะตั 10 ะฟัะพะตะบัะพะฒ ั ัะฐะทะฝะพะน ะฝะฐะณััะทะบะพะน (ะพั 10 ะดะพ 200 ัะพะตะดะธะฝะตะฝะธะน ะบะฐะถะดัะน).

## ๐๏ธ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
pgbouncer.net/
โโโ src/
โ   โโโ PgBouncer.Core/        # ะฏะดัะพ: ะฟัะปะธะฝะณ, ะฟัะพัะพะบะพะป
โ   โ   โโโ Pooling/           # ConnectionPool, PoolManager
โ   โ   โโโ Protocol/          # PostgreSQL ะฟัะพัะพะบะพะป
โ   โโโ PgBouncer.Server/      # ะกะตัะฒะตั ะธ Dashboard
โ       โโโ ClientSession.cs   # ะะฑัะฐะฑะพัะบะฐ ะบะปะธะตะฝัะพะฒ
โ       โโโ ProxyServer.cs     # TCP-ัะตัะฒะตั
โ       โโโ wwwroot/           # ะะตะฑ-ะธะฝัะตััะตะนั
โโโ tests/
    โโโ PgBouncer.StressTester/ # ะะฐะณััะทะพัะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต
```

## ๐ ะะธัะตะฝะทะธั

MIT License

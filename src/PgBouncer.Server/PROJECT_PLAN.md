# План проекта: Исправление StressTester и устранение багов пулинга

## Цель
Исправить проблемы с запуском StressTester и реализовать полноценные сценарии тестирования, соответствующие отчетам о сбоях. Устранить выявленные ошибки в PgBouncer.Server (ошибки подключения, конфликты подготовленных операторов и ошибки транзакций).

## Архитектура и изменения

### 1. StressTester (Клиентская часть)
- **StressTester.csproj**: Проверить совместимость net10.0, при необходимости откатить до net9.0/net8.0 для стабильности.
- **Program.cs**: Полная переработка. Реализация 6 сценариев:
  - `Notification Worker`: Высокая нагрузка на короткие соединения.
  - `Log Collector`: Массовые вставки.
  - `Report Generator`: Длительные запросы.
  - `Session Manager`: Управление сессиями.
  - `EF Core Transaction Test`: Тест транзакций (воспроизведение ошибки NpgsqlTransaction).
  - `Extended Query Protocol`: Использование Prepared Statements (воспроизведение ошибки 42P05).

### 2. PgBouncer.Server (Серверная часть)
- **ProxyServer.cs / TransactionPoolingSession.cs**: 
  - Исправить гонку состояний при закрытии соединений ("Connection is not open").
  - Реализовать очистку состояния подготовленных операторов при возврате соединения в пул (DEALLOCATE ALL или управление именами).
  - Исправить сброс состояния транзакции при ошибках.

## Тестирование
1. Запуск StressTester локально против работающего PgBouncer.Server.
2. Верификация отсутствия ошибок в таблице результатов (Success Rate должен быть 100%).

## Команды
- Сборка: `dotnet build`
- Запуск сервера: `dotnet run --project PgBouncer.Server`
- Запуск теста: `dotnet run --project StressTester`
